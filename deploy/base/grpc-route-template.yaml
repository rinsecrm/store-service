apiVersion: gateway.networking.k8s.io/v1
kind: GRPCRoute
metadata:
  name: store-canary-pr-PLACEHOLDER
  namespace: backoffice  # stable namespace where apex service lives
spec:
  parentRefs:
    - kind: Service
      name: store        # apex ClusterIP used by callers
  rules:
    - matches:
        - headers:
            - name: x-canary
              value: "PLACEHOLDER"
      backendRefs:
        - name: store
          namespace: store-canary-pr-PLACEHOLDER  # cross-namespace reference
          port: 80
    - backendRefs:
        - name: store
          namespace: backoffice  # stable namespace
          port: 80
